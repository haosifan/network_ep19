---
title: "data_aquisition_twitter"
author: "Stefan Haußner"
date: "12 Juli 2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(rtweet)
library(openxlsx)
```

#Einlesen der Daten

Liste aller MEPs (Stand 12.07.2019) mit Parteizugehörigkeit, Land und Fraktion und dazugehörigem Twitternamen.

Link user_ids to screen_name in meps_list_withtwitter.

```{r}
lookup_userids <- function(user_name) {
  user_info <- rtweet::lookup_users(user_name, parse = TRUE)
  return(user_info$user_id)
}

meps_full_list <- openxlsx::read.xlsx("../data/list_meps_2019.xlsx", sheet = 1) %>% tbl_df()
meps_full_list

meps_list_withtwitter <- meps_full_list %>% 
  filter(!is.na(twitter_name)) %>% 
  mutate(twitter_id = lookup_userids(twitter_name))
meps_list_withtwitter
```

Obtain edge list of MEP-network:

First get all friends of all MEPs (with twitter). Afterwards filter where the user_id of the friends-set is part of the MEP-set.
Result is an edge list, which can be used for making a directed network.

```{r}

allfriends <- rtweet::get_friends(users = meps_list_withtwitter$twitter_id, retryonratelimit = TRUE)

edge_list <- allfriends %>% 
  filter(user_id %in% meps_list_withtwitter$twitter_id)

write_csv2(x = allfriends, path = "../data/allfriends.csv")
write_csv2(x = edge_list, path = "../data/edge_list.csv")
write_csv2(x = meps_full_list, "../data/meps_full_list.csv")
write_csv2(x = meps_list_withtwitter, path = "../data/meps_twitter.csv")
```


